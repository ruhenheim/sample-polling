var btn, fetch, fetchInterval, startPolling;

btn = document.getElementById('polling');
btn.value = 'working...';
btn.disabled = true;

startPolling = function() {
  fetchInterval();
};

fetchInterval = function() {
  fetch();
  setTimeout(fetchInterval(), 5000);
};

fetch = function() {
  $.ajax({
    url: '/fetch',
    type: 'GET',
    dataType: 'JS',
    success: function(post) {
      console.log("polling");
      if (post && post.scraping_completed == true) {
        btn.value = 'completed!';
        return btn.disabled = false;
        // ループ終わる＆画面にスクレイピング結果を出す
        // アカウント登録エラー
        // 現在の預貯金額
        if post.redirect_url
          href = post.redirect_url
      }
    }
  });
};

if (true) {
  startPolling();
}
